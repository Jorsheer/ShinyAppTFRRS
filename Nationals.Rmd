---
title: "Nationals.Rmd"
output: html_document
date: "2025-05-11"
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r track-ui, echo=FALSE}
inputPanel(
  selectInput("year", "Select Year:", choices = sort(unique(final_nats$Year)), selected = max(final_nats$Year)),
  selectInput("event", "Select Event:", choices = sort(unique(final_nats$Event)), selected = "60 Meters (Men)")
)

renderPlot({

  convert_time <- function(time_str) {
    if (is.na(time_str)) return(NA)
    if (grepl(":", time_str)) {
      parts <- strsplit(time_str, ":")[[1]]
      return(as.numeric(parts[1]) * 60 + as.numeric(parts[2]))
    } else {
      return(as.numeric(time_str))
    }
  }
  
  filtered_data <- final_nats |>
    filter(Year == input$year, Event == input$event)
  
  filtered_data$Time <- sapply(filtered_data$Time, convert_time)
  filtered_data$Mark <- gsub("[^0-9\\.]", "", filtered_data$Mark)
  filtered_data$Mark <- as.numeric(filtered_data$Mark)

  if (all(is.na(filtered_data$Time)) && any(!is.na(filtered_data$Mark))) {
    barplot(
      filtered_data$Mark,
      names.arg = filtered_data$Athlete,
      las = 2,
      main = paste("Marks for", input$event),
      ylab = "Mark"
    )
  } else if (any(!is.na(filtered_data$Time))) {
    barplot(
      filtered_data$Time,
      names.arg = filtered_data$Athlete,
      las = 2,
      main = paste("Times for", input$event),
      ylab = "Time (seconds)"
    )
  } else {
    plot.new()
    text(0.5, 0.5, "No valid data for selected event", cex = 1.5)
  }
})

```
